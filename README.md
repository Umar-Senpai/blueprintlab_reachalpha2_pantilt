# blueprintlab_reachalpha2_pantilt
This is a ROS package for detecting light from an optical modem and controlling the reachalpha2 Pan&Tilt Arm. The project has two parts:

### Light Detection
The blinking LED lights on the LUMA optical modem are detected using thresholding with OpenCV. The `tracking_light_node.py` file has the ROS node that subscribes to camera output `/usb_cam/image_raw` which can come from either the new usb cameras or the analog usb cameras using EasyCap. It then publishes a Marker named `modem_center`. The node makes use of `tracking_light_app.py` to detect the lights and determine the center of optical modem. 

### Motion Controller
The motion controller uses Resolved rate motion controller to minimize the gap between camera center and modem center. The `motion_controller.py` file is a ROS node that simply subscribes to modem_center and publishes the velocity commands generated by resolved rate algorithm to `/alpha2/joint_velocity_controller/command`.

## HOW TO RUN
First connect the Pan&Tilt Arm with the power supply and run the controller in the `blueprintlab_reachalpha2_manipulator` package.

```
roslaunch blueprintlab_reachalpha2_manipulator alpha_ros_control.launch
```

Then for safety purposes, run the rqt_publisher
```
rosrun rqt_publisher rqt_publisher
```

And add the following command and check it

![Screenshot from 2022-07-15 14-34-40](https://user-images.githubusercontent.com/31202659/179224066-7411db4b-ca10-4f23-8925-d213544a2746.png)

Run the pantilt launch file, which will start detecting the light, update the modem center and send velocity commands to the controller
```
roslaunch blueprintlab_reachalpha2_pantilt camera_panTilt_control.launch 
```

If we kill this launch file, the arm will keep moving if we do not run the rqt_publisher and send the 0,0 velocity to both joints. 

### Change Camera
The launch file has some commented code that can be uncommented to change between cameras. We can use either the analog output camera or the normal one. 

## VIEW URDF
The package also has a view_urdf launch file that can be used to simulate how the arm works.
```
roslaunch blueprintlab_reachalpha2_pantilt view_urdf.launch 
```

## ISSUES WITH ANALOG CAMERA
The analog camera shows a distorted colored image when run using the launch file. It is probably because of the video standard (NTSC PAL etc.) which is used as default by the `usb_cam` package. To fix the color, we can first run the ffplay command to change the video standard using:
```
ffplay /dev/video0 -standard PAL
```

and then close it and run the `camera_panTilt_control.launch` file and the image should be correctly colored.
